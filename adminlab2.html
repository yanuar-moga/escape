<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard Inventaris Lab Komputer 2</title>

<style>
    body {
        font-family: 'Calibri', sans-serif;
        background: #f4f7fb;
        padding: 20px;
        margin: 0;
    }

    .header {
        background: #0056b3;
        padding: 15px 25px;
        color: white;
        font-size: 28px;
        font-weight: bold;
        border-left: 10px solid #ffcc00;
        width: fit-content;
        border-radius: 5px;
    }

    .card-container {
        display: grid;
        grid-template-columns: repeat(3, 260px);
        gap: 15px;
        margin-top: 20px;
    }

    .card {
        background: white;
        border-left: 6px solid #ffcc00;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        font-size: 18px;
    }

    .card-title {
        color: #0056b3;
        font-weight: bold;
    }

    #mapGrid {
        display: grid;
        grid-template-columns: repeat(11, 55px);
        gap: 6px;
        margin-top: 30px;
        margin-bottom: 40px;
    }

    .meja {
        width: 55px;
        height: 45px;
        border-radius: 6px;
        font-weight: bold;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        user-select: none;
    }

    .normal   { background: #28a745; color: white; }
    .ringan   { background: #ffc107; color: black; }
    .berat    { background: #dc3545; color: white; }
    .signed   { background: #007bff !important; color: white !important; }
    .marked   { background: #7a00ff !important; color: white !important; }

    /* ‚úîÔ∏è BARU: meja tanpa inventaris */
    .empty    { background: #c4c4c4 !important; color: #555 !important; }

    .kosong   { background: transparent; border: none; cursor: default; }

    #detailBox {
        background: white;
        width: 360px;
        padding: 18px;
        border-radius: 8px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        display: none;
        position: fixed;
        right: 24px;
        top: 120px;
        z-index: 60;
    }

    #detailBox h3 {
        margin-top: 0;
        color: #0056b3;
        border-left: 6px solid #ffcc00;
        padding-left: 8px;
    }

    .btn {
        display:inline-block;padding:8px 12px;border-radius:6px;border:1px solid #0056b3;cursor:pointer;
        background: white;color:#0056b3;font-weight:bold;
    }

    .btn-ghost { background:transparent;border:1px solid #ddd;color:#333; }
    .btn-primary { background:#007bff;color:white;border:none; }
    .btn-mark    { background:#7a00ff;color:white;border:none; }
    .btn-reset   { background:#ff3399;color:white;border:none; }
    .btn-download{ background:#00aa55;color:white;border:none; }

    #adminControl {
        position: fixed;
        top: 12px;
        right: 12px;
        z-index: 9999;
        display:flex;
        gap:8px;
        align-items:center;
    }

    #btnLogin,#btnLogout {
        background: #6436ff;
        color: white;
        border: none;
        padding: 10px 14px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        font-size: 13px;
        box-shadow: 0 0 8px rgba(0,0,0,0.15);
    }
    #btnLogout { background:#e91e63; }

</style>
</head>
<body>

<div class="header">üìò Dashboard Inventaris Lab Komputer</div>

<div id="adminControl">
    <button id="btnLogin" onclick="loginAdmin()">Masuk Admin</button>
    <button id="btnLogout" onclick="logoutAdmin()" style="display:none;">Keluar</button>
</div>

<div style="margin-top:14px;margin-bottom:6px;">
    <button id="resetSigns" class="btn btn-reset">Reset Semua Sign-In</button>
    <button id="resetMarkBtn" class="btn btn-reset">Reset Semua Tanda Masalah</button>
    <button id="downloadLog" class="btn btn-download">Download Log</button>
</div>

<div id="dashboard" class="card-container" style="margin-bottom:10px;">
    <div class="card"><div class="card-title">Total Perangkat</div><span id="totalPerangkat">-</span></div>
    <div class="card"><div class="card-title">Jumlah Windows</div><span id="totalWindows">-</span></div>
    <div class="card"><div class="card-title">Jumlah Chromebook</div><span id="totalChromebook">-</span></div>
    <div class="card"><div class="card-title">Perangkat Normal</div><span id="normalCount">-</span></div>
    <div class="card"><div class="card-title">Rusak Ringan</div><span id="ringanCount">-</span></div>
    <div class="card"><div class="card-title">Rusak Berat</div><span id="beratCount">-</span></div>
    <div class="card"><div class="card-title">Kebutuhan Mouse</div><span id="mouseNeed">-</span></div>
    <div class="card"><div class="card-title">Kebutuhan Keyboard</div><span id="keyboardNeed">-</span></div>
</div>

<h2 style="color:#0056b3;margin-top:8px;">üìç Peta Meja Lab</h2>
<div id="mapGrid"></div>
<div id="detailBox"></div>

<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script>
/* ======================= CONFIG ======================= */
const ADMIN_PIN = "17081945";
let isAdmin = false;

/* wifi & belajar data */
const WIFI = {};
for(let i=1;i<=36;i++){ WIFI[i] = { user: `${i}lab2`, pass: String(i) }; }

const CHROME_ACCOUNTS = [
    "putri.wika67@smp.belajar.id","kallista.putri192@smp.belajar.id",
    "yulia.al83@smp.belajar.id","nazril.hidayatullah18@smp.belajar.id",
    "muhammad.febri1219@smp.belajar.id","muhamad.rizkan48@smp.belajar.id",
    "safania.52@smp.belajar.id","nia.hidayati013@smp.belajar.id",
    "nayilla_azzahra25@smp.belajar.id","widya.setya31@smp.belajar.id",
    "yusuf.fahreza18@smp.belajar.id","muhamad.arif3591@smp.belajar.id",
    "muhamad.faiz3380@smp.belajar.id","muhammad.khairul8017@smp.belajar.id",
    "aisyatul.maulida49@smp.belajar.id"
];
const CHROME_PASS = "Belajar2025!";

/* localStorage keys */
const LS_SIGNED = "lab2_signed";
const LS_MARK   = "lab2_marked";
const LS_LOG_PREF = "lab2_log_";

let SIGNED = JSON.parse(localStorage.getItem(LS_SIGNED) || "{}");
let MARKED = JSON.parse(localStorage.getItem(LS_MARK) || "{}");

function todayKey(){ return LS_LOG_PREF + new Date().toISOString().split("T")[0]; }

/* ======================= EXCEL LOAD ======================= */
let INV = [];

async function loadExcel(){
    try {
        const res = await fetch("assets/inventarislab2.xlsx");
        const buf = await res.arrayBuffer();
        const wb = XLSX.read(buf, { type:"array" });
        INV = XLSX.utils.sheet_to_json(wb.Sheets["INV"]);
    } catch {}

    renderMap();
}

/* ======================= MAP RENDER ======================= */
function renderMap(){
    const grid = document.getElementById("mapGrid");
    grid.innerHTML = "";

    const rows = [
        [22,21,20,19,18,17,"",4,3,2,1],
        [28,27,26,25,24,23,"",8,7,6,5],
        [34,33,32,31,30,29,"",12,11,10,9],
        [40,39,38,37,36,35,"",16,15,14,13]
    ];

    rows.forEach(r=>{
        r.forEach(no=>{
            const div = document.createElement("div");

            if(no === ""){
                div.className = "meja kosong";
                grid.appendChild(div);
                return;
            }

            const item = INV.find(x => String(x["NO MEJA"]).trim() === String(no).trim());

            let cls;

            if(item){
                /* normal kondisi */
                if(MARKED[String(no)]) cls = "marked";
                else if(SIGNED[String(no)]) cls = "signed";
                else {
                    const k = (item.Kondisi||"").toLowerCase();
                    if(k==="normal") cls="normal";
                    else if(k.includes("ringan")) cls="ringan";
                    else if(k.includes("berat")) cls="berat";
                    else cls="normal";
                }
            } else {
                /* ‚úîÔ∏è BARU: meja tanpa data inventaris */
                cls = "empty";
            }

            div.className = "meja "+cls;
            div.textContent = no;
            div.onclick = ()=> showDetail(no);
            grid.appendChild(div);
        });
    });
}

/* ======================= DETAIL & ADMIN ======================= */
function showDetail(no){
    alert("Detail meja "+no); // disederhanakan karena fokus perbaikan warna
}

function loginAdmin(){
    const p = prompt("PIN?");
    if(p===ADMIN_PIN){ isAdmin=true; }
}
function logoutAdmin(){ isAdmin=false; }

loadExcel();
</script>

</body>
</html>
