<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Inventaris Lab 2 - Mapping Laptop</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f3f4f6;
        }

        header {
            background: #1e3a8a;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .container {
            width: 95%;
            margin: auto;
            margin-top: 20px;
        }

        /* Dashboard Cards */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            margin: 0;
            font-size: 18px;
            color: #374151;
        }

        .value {
            font-size: 32px;
            margin-top: 10px;
            font-weight: bold;
            color: #1e3a8a;
        }

        /* MAP Area */
        .map-container {
            margin-top: 35px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
        }

        .map-grid {
            display: grid;
            grid-template-columns: repeat(11, 1fr);
            gap: 6px;
            margin-top: 10px;
        }

        .meja {
            padding: 12px;
            text-align: center;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid #ccc;
        }

        /* Warna kondisi */
        .normal {
            background: #4ade80;
        }

        .ringan {
            background: #fb923c;
        }

        .berat {
            background: #ef4444;
        }

        .kosong {
            background: #e5e7eb;
        }

        /* Modal */
        #modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.65);
            display: none;
            justify-content: center;
            align-items: center;
        }

        #modalBox {
            background: white;
            width: 450px;
            padding: 20px;
            border-radius: 12px;
        }

        .closeBtn {
            float: right;
            cursor: pointer;
            font-size: 20px;
        }

        table.detail {
            width: 100%;
            margin-top: 10px;
        }

        table.detail td {
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }

        button {
            padding: 10px 18px;
            border: none;
            background: #1e3a8a;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>

</head>

<body>
    <header>Inventaris Lab 2 – Mapping Laptop</header>

    <div class="container">

        <!-- Dashboard -->
        <div class="dashboard">
            <div class="card">
                <h3>Total Perangkat</h3>
                <div class="value" id="totalDevice">0</div>
            </div>

            <div class="card">
                <h3>Total Laptop</h3>
                <div class="value" id="totalLaptop">0</div>
            </div>

            <div class="card">
                <h3>Total Chromebook</h3>
                <div class="value" id="totalChromebook">0</div>
            </div>

            <div class="card">
                <h3>Normal</h3>
                <div class="value" id="normal">0</div>
            </div>

            <div class="card">
                <h3>Rusak Ringan</h3>
                <div class="value" id="ringan">0</div>
            </div>

            <div class="card">
                <h3>Rusak Berat</h3>
                <div class="value" id="berat">0</div>
            </div>

            <div class="card">
                <h3>Kebutuhan Mouse</h3>
                <div class="value" id="needMouse">0</div>
            </div>

            <div class="card">
                <h3>Kebutuhan Keyboard</h3>
                <div class="value" id="needKeyboard">0</div>
            </div>

        </div>

        <!-- MAP -->
        <div class="map-container">
            <h2>Mapping Laptop (Sheet MAP)</h2>
            <div class="map-grid" id="mapGrid"></div>
        </div>

        <button onclick="exportPDF()">Export PDF</button>

    </div>

    <!-- Modal -->
    <div id="modal">
        <div id="modalBox">
            <span class="closeBtn" onclick="closeModal()">✖</span>
            <h2>Detail Perangkat</h2>
            <table class="detail" id="detailTable"></table>
        </div>
    </div>

    <script>
        const fileURL = "assets/inventarislab2.xlsx?raw=true";
        let INV = [];

        async function loadExcel() {
            const res = await fetch(fileURL);
            const ab = await res.arrayBuffer();
            const wb = XLSX.read(ab);

            INV = XLSX.utils.sheet_to_json(wb.Sheets["INV"]);
            const MAP = XLSX.utils.sheet_to_json(wb.Sheets["MAP"], { header: 1 });

            processData(INV);
            renderMAP(MAP);
        }

        function processData(inv) {

            const totalDevice = inv.filter(x => (x.OS || "").trim() !== "").length;
            const totalLaptop = inv.filter(x => (x.OS || "").toLowerCase().includes("windows")).length;
            const totalChromebook = inv.filter(x => (x.OS || "").toLowerCase().includes("chromebook")).length;

            const normal = inv.filter(x => (x.Kondisi || "").toLowerCase() === "normal").length;
            const ringan = inv.filter(x => (x.Kondisi || "").toLowerCase().includes("ringan")).length;
            const berat = inv.filter(x => (x.Kondisi || "").toLowerCase().includes("berat")).length;

            const needMouse = inv.filter(x => (x.Mouse || "").trim() === "").length;
            const needKeyboard = inv.filter(x => (x.Keyboard || "").trim() === "").length;

            // Update dashboard
            document.getElementById("totalDevice").innerText = totalDevice;
            document.getElementById("totalLaptop").innerText = totalLaptop;
            document.getElementById("totalChromebook").innerText = totalChromebook;
            document.getElementById("normal").innerText = normal;
            document.getElementById("ringan").innerText = ringan;
            document.getElementById("berat").innerText = berat;
            document.getElementById("needMouse").innerText = needMouse;
            document.getElementById("needKeyboard").innerText = needKeyboard;
        }

        function renderMAP(mapData) {
            const grid = document.getElementById("mapGrid");
            grid.innerHTML = "";

            mapData.forEach(row => {
                row.forEach(meja => {
                    const div = document.createElement("div");

                    if (meja === "" || meja == null) {
                        div.className = "meja kosong";
                        div.innerText = "";
                    } else {
                        const item = INV.find(x => Number(x["NO MEJA"]) === Number(meja));
                        let kondisi = "kosong";

                        if (item) {
                            const k = (item.Kondisi || "").toLowerCase();
                            if (k === "normal") kondisi = "normal";
                            else if (k.includes("ringan")) kondisi = "ringan";
                            else if (k.includes("berat")) kondisi = "berat";
                        }

                        div.className = "meja " + kondisi;
                        div.innerText = meja;

                        div.onclick = () => showDetail(meja);
                    }

                    grid.appendChild(div);
                });
            });
        }

        function showDetail(meja) {
            const item = INV.find(x => Number(x["NO MEJA"]) === Number(meja));

            const tbl = document.getElementById("detailTable");
            tbl.innerHTML = "";

            if (!item) {
                tbl.innerHTML = "<tr><td>Tidak ada data untuk meja ini.</td></tr>";
            } else {
                Object.keys(item).forEach(k => {
                    tbl.innerHTML += `<tr><td><b>${k}</b></td><td>${item[k]}</td></tr>`;
                });
            }

            document.getElementById("modal").style.display = "flex";
        }

        function closeModal() {
            document.getElementById("modal").style.display = "none";
        }

        // Export PDF
        async function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(16);
            doc.text("Laporan Inventaris Lab 2", 10, 15);

            let y = 30;
            INV.forEach(item => {
                doc.setFontSize(10);
                doc.text(JSON.stringify(item), 10, y);
                y += 7;
            });

            doc.save("Laporan-Inventaris-Lab2.pdf");
        }

        loadExcel();
    </script>

</body>

</html>
