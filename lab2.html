<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Inventaris Lab Komputer</title>

    <style>
        body {
            font-family: 'Calibri', sans-serif;
            background: #f4f7fb;
            padding: 20px;
            margin: 0;
        }

        /* HEADER */
        .header {
            background: #0056b3;
            padding: 15px 25px;
            color: white;
            font-size: 28px;
            font-weight: bold;
            border-left: 10px solid #ffcc00;
            width: fit-content;
            border-radius: 5px;
        }

        /* DASHBOARD CARDS */
        .card-container {
            display: grid;
            grid-template-columns: repeat(3, 260px);
            gap: 15px;
            margin-top: 20px;
        }

        .card {
            background: white;
            border-left: 6px solid #ffcc00;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
            font-size: 18px;
        }

        .card-title {
            color: #0056b3;
            font-weight: bold;
        }

        /* MAP GRID */
        #mapGrid {
            display: grid;
            grid-template-columns: repeat(11, 55px);
            gap: 6px;
            margin-top: 30px;
            margin-bottom: 40px;
        }

        .meja {
            width: 55px;
            height: 45px;
            border-radius: 6px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: 0.3s;
        }

        /* Animasi Glow */
        .ringan {
            background: #ffc107; 
            color: black;
            animation: glowYellow 1.5s infinite alternate;
        }
        @keyframes glowYellow {
            from { box-shadow: 0 0 6px #ffeb99; }
            to { box-shadow: 0 0 12px #ffc107; }
        }

        .berat { 
            background: #dc3545; 
            color: white;
            animation: glowRed 1.5s infinite alternate;
        }
        @keyframes glowRed {
            from { box-shadow: 0 0 6px #ff9999; }
            to { box-shadow: 0 0 15px #dc3545; }
        }

        .normal { background: #28a745; color: white; }
        .kosong { background: transparent; border: none; cursor: default; }

        /* POPUP DETAIL */
        #detailBox {
            background: white;
            width: 360px;
            padding: 18px;
            border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            display: none;
            margin-bottom: 40px;
        }

        #detailBox h3 {
            margin-top: 0;
            color: #0056b3;
            border-left: 6px solid #ffcc00;
            padding-left: 8px;
        }

        /* GRAFIK */
        .chart-container {
            margin-top: 40px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
            border-left: 8px solid #0056b3;
        }

        /* PDF Button */
        #pdfBtn {
            background: #ffcc00;
            padding: 12px 20px;
            border: none;
            font-size: 18px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin: 20px 0;
            color: #0056b3;
            transition: 0.3s;
        }
        #pdfBtn:hover {
            background: #ffdb4d;
        }
    </style>
</head>
<body>

<div class="header">üìò Dashboard Inventaris Lab Komputer</div>

<!-- DASHBOARD -->
<div id="dashboard" class="card-container">
    <div class="card"><div class="card-title">Total Perangkat</div><span id="totalPerangkat">-</span></div>
    <div class="card"><div class="card-title">Jumlah Windows</div><span id="totalWindows">-</span></div>
    <div class="card"><div class="card-title">Jumlah Chromebook</div><span id="totalChromebook">-</span></div>

    <div class="card"><div class="card-title">Perangkat Normal</div><span id="normalCount">-</span></div>
    <div class="card"><div class="card-title">Rusak Ringan</div><span id="ringanCount">-</span></div>
    <div class="card"><div class="card-title">Rusak Berat</div><span id="beratCount">-</span></div>

    <div class="card"><div class="card-title">Kebutuhan Mouse</div><span id="mouseNeed">-</span></div>
    <div class="card"><div class="card-title">Kebutuhan Keyboard</div><span id="keyboardNeed">-</span></div>
</div>

<!-- GRAFIK -->
<h2 style="color:#0056b3;margin-top:45px;">üìä Grafik Inventaris Perangkat</h2>

<div class="chart-container">
    <canvas id="chartPie"></canvas>
</div>

<div class="chart-container">
    <canvas id="chartBar"></canvas>
</div>

<div class="chart-container">
    <canvas id="chartOS"></canvas>
</div>

<div class="chart-container">
    <canvas id="chartLine"></canvas>
</div>

<button id="pdfBtn">üìÑ Export PDF</button>

<!-- DETAIL -->
<div id="detailBox"></div>

<h2 style="color:#0056b3;margin-top:35px;">üìç Peta Meja Lab</h2>

<div id="mapGrid"></div>


<!-- LIBRARIES -->
<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let INV = [];

/* LOAD EXCEL */
async function loadExcel() {
    const res = await fetch("assets/inventarislab2.xlsx");
    const buf = await res.arrayBuffer();
    const wb = XLSX.read(buf, { type: "array" });

    INV = XLSX.utils.sheet_to_json(wb.Sheets["INV"]);

    updateDashboard();
    renderCharts();
    renderMap();
}
loadExcel();

/* DASHBOARD */
function updateDashboard() {

    const win = INV.filter(x => (x.OS || "").toLowerCase() === "windows 10 pro 64 bit");
    const chrome = INV.filter(x => (x.OS || "").toLowerCase() === "chromebook");

    const normal   = INV.filter(x => (x.Kondisi || "").toLowerCase() === "normal");
    const ringan   = INV.filter(x => (x.Kondisi || "").toLowerCase().includes("ringan"));
    const berat    = INV.filter(x => (x.Kondisi || "").toLowerCase().includes("berat"));

    const needMouse    = INV.filter(x => (x.Mouse || "").toLowerCase() === "tidak");
    const needKeyboard = INV.filter(x => (x.Keyboard || "").toLowerCase() === "tidak");

    document.getElementById("totalPerangkat").innerText = win.length + chrome.length;
    document.getElementById("totalWindows").innerText = win.length;
    document.getElementById("totalChromebook").innerText = chrome.length;

    document.getElementById("normalCount").innerText = normal.length;
    document.getElementById("ringanCount").innerText = ringan.length;
    document.getElementById("beratCount").innerText = berat.length;

    document.getElementById("mouseNeed").innerText = needMouse.length;
    document.getElementById("keyboardNeed").innerText = needKeyboard.length;
}

/* =============================
   GRAFIK
============================= */
function renderCharts() {

    const normal = INV.filter(x => (x.Kondisi||"").toLowerCase()==="normal").length;
    const ringan = INV.filter(x => (x.Kondisi||"").toLowerCase().includes("ringan")).length;
    const berat  = INV.filter(x => (x.Kondisi||"").toLowerCase().includes("berat")).length;

    const win = INV.filter(x => (x.OS||"").toLowerCase()==="windows 10 pro 64 bit").length;
    const chrome = INV.filter(x => (x.OS||"").toLowerCase()==="chromebook").length;

    // PIE KONDISI
    new Chart(document.getElementById("chartPie"), {
        type: "pie",
        data: {
            labels: ["Normal", "Rusak Ringan", "Rusak Berat"],
            datasets: [{
                data: [normal, ringan, berat],
                backgroundColor: ["#0056b3", "#ffcc00", "#dc3545"]
            }]
        }
    });

    // BAR KONDISI
    new Chart(document.getElementById("chartBar"), {
        type: "bar",
        data: {
            labels: ["Normal", "Ringan", "Berat"],
            datasets: [{
                label: "Jumlah",
                data: [normal, ringan, berat],
                backgroundColor: ["#0056b3", "#ffcc00", "#dc3545"]
            }]
        }
    });

    // PIE OS
    new Chart(document.getElementById("chartOS"), {
        type: "pie",
        data: {
            labels: ["Windows", "Chromebook"],
            datasets: [{
                data: [win, chrome],
                backgroundColor: ["#0056b3", "#28a745"]
            }]
        }
    });

    // LINE TREND
    new Chart(document.getElementById("chartLine"), {
        type: "line",
        data: {
            labels: ["Normal", "Ringan", "Berat"],
            datasets: [{
                label: "Jumlah Perangkat",
                data: [normal, ringan, berat],
                borderColor: "#0056b3",
                backgroundColor: "#ffcc00"
            }]
        }
    });
}

/* PDF EXPORT */
document.getElementById("pdfBtn").onclick = async () => {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    pdf.text("Laporan Inventaris Lab Komputer", 10, 10);

    let y = 20;

    pdf.text("Total Perangkat: " + document.getElementById("totalPerangkat").innerText, 10, y); y+=8;
    pdf.text("Normal: " + document.getElementById("normalCount").innerText, 10, y); y+=8;
    pdf.text("Ringan: " + document.getElementById("ringanCount").innerText, 10, y); y+=8;
    pdf.text("Berat: " + document.getElementById("beratCount").innerText, 10, y); y+=8;

    const charts = ["chartPie","chartBar","chartOS","chartLine"];

    for (let id of charts) {
        let canvas = document.getElementById(id);
        let img = canvas.toDataURL("image/png", 1.0);

        pdf.addPage();
        pdf.addImage(img, "PNG", 10, 20, 180, 100);
    }

    pdf.save("Laporan_Inventaris.pdf");
};

/* =============================
   MAP
============================= */
function renderMap() {
    const grid = document.getElementById("mapGrid");
    grid.innerHTML = "";

    const rows = [
        [22,21,20,19,18,17,"",4,3,2,1],
        [28,27,26,25,24,23,"",8,7,6,5],
        [34,33,32,31,30,29,"",12,11,10,9],
        [40,39,38,37,36,35,"",16,15,14,13]
    ];

    rows.forEach(r => {
        r.forEach(mejaNum => {

            const div = document.createElement("div");

            if (mejaNum === "") {
                div.className = "meja kosong";
                grid.appendChild(div);
                return;
            }

            const item = INV.find(x => Number(x["NO MEJA"]) === Number(mejaNum));
            let kondisiClass = "kosong";

            if (item) {
                let k = (item.Kondisi || "").toLowerCase();
                if (k === "normal") kondisiClass = "normal";
                else if (k.includes("ringan")) kondisiClass = "ringan";
                else if (k.includes("berat")) kondisiClass = "berat";
            }

            div.className = `meja ${kondisiClass}`;
            div.textContent = mejaNum;

            if (item) div.onclick = () => showDetail(mejaNum);

            grid.appendChild(div);
        });
    });
}

/* DETAIL */
function showDetail(no) {
    const box = document.getElementById("detailBox");
    const item = INV.find(x => Number(x["NO MEJA"]) === no);

    box.style.display = "block";

    if (!item) {
        box.innerHTML = `<h3>Detail Meja ${no}</h3>Data tidak ditemukan`;
        return;
    }

    let ketRusak = item.Keterangan ? ` (${item.Keterangan})` : "";

    box.innerHTML = `
        <h3>Detail Meja ${no}</h3>

        <b>No Inventaris:</b> ${item["No Inventaris"] || "-"}<br>
        <b>Merek / Tipe:</b> ${item["Merek / Tipe"] || "-"}<br>
        <b>Processor:</b> ${item.Processor || "-"}<br>
        <b>RAM:</b> ${item.RAM || "-"}<br>
        <b>Storage:</b> ${item.Storage || "-"}<br>
        <b>Layar:</b> ${item.Layar || "-"}<br>
        <b>OS:</b> ${item.OS || "-"}<br><br>

        <b>Kondisi:</b> ${item.Kondisi || "-"} ${ketRusak}<br>
        <b>Mouse:</b> ${item.Mouse || "-"}<br>
        <b>Keyboard:</b> ${item.Keyboard || "-"}<br>
    `;
}
</script>

</body>
</html>
