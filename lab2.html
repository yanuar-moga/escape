<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Inventaris Lab Komputer</title>

    <style>
        body {
            font-family: 'Calibri', sans-serif;
            background: #f4f7fb;
            padding: 20px;
            margin: 0;
        }

        /* HEADER */
        .header {
            background: #0056b3;
            padding: 15px 25px;
            color: white;
            font-size: 28px;
            font-weight: bold;
            border-left: 10px solid #ffcc00;
            width: fit-content;
            border-radius: 5px;
        }

        /* DASHBOARD CARDS */
        .card-container {
            display: grid;
            grid-template-columns: repeat(3, 260px);
            gap: 15px;
            margin-top: 20px;
        }

        .card {
            background: white;
            border-left: 6px solid #ffcc00;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
            font-size: 18px;
        }

        .card-title {
            color: #0056b3;
            font-weight: bold;
        }

        /* MAP GRID */
        #mapGrid {
            display: grid;
            grid-template-columns: repeat(11, 55px);
            gap: 6px;
            margin-top: 30px;
            margin-bottom: 40px;
        }

        .meja {
            width: 55px;
            height: 45px;
            border-radius: 6px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .normal { background: #28a745; color: white; }
        .ringan { background: #ffc107; color: black; }
        .berat { background: #dc3545; color: white; }
        .kosong { background: transparent; border: none; cursor: default; }

        /* POPUP DETAIL */
        #detailBox {
            background: white;
            width: 360px;
            padding: 18px;
            border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            display: none;
        }

        #detailBox h3 {
            margin-top: 0;
            color: #0056b3;
            border-left: 6px solid #ffcc00;
            padding-left: 8px;
        }
    </style>
</head>
<body>

<div class="header">üìò Dashboard Inventaris Lab Komputer</div>

<!-- DASHBOARD -->
<div id="dashboard" class="card-container">
    <div class="card"><div class="card-title">Total Perangkat</div><span id="totalPerangkat">-</span></div>
    <div class="card"><div class="card-title">Jumlah Windows</div><span id="totalWindows">-</span></div>
    <div class="card"><div class="card-title">Jumlah Chromebook</div><span id="totalChromebook">-</span></div>

    <div class="card"><div class="card-title">Perangkat Normal</div><span id="normalCount">-</span></div>
    <div class="card"><div class="card-title">Rusak Ringan</div><span id="ringanCount">-</span></div>
    <div class="card"><div class="card-title">Rusak Berat</div><span id="beratCount">-</span></div>

    <div class="card"><div class="card-title">Kebutuhan Mouse</div><span id="mouseNeed">-</span></div>
    <div class="card"><div class="card-title">Kebutuhan Keyboard</div><span id="keyboardNeed">-</span></div>
</div>

<h2 style="color:#0056b3;margin-top:35px;">üìç Peta Meja Lab</h2>

<div id="mapGrid"></div>

<div id="detailBox"></div>

<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script>
let INV = [];

/* =============================
   LOAD EXCEL
============================= */
async function loadExcel() {
    const res = await fetch("assets/inventarislab2.xlsx");
    const buf = await res.arrayBuffer();
    const wb = XLSX.read(buf, { type: "array" });

    INV = XLSX.utils.sheet_to_json(wb.Sheets["INV"]);

    updateDashboard();
    renderMap();
}
loadExcel();

/* Fungsi membaca nomor meja dari semua kemungkinan nama kolom */
function getNoMeja(row) {
    return Number(
        row["NO MEJA"] ||
        row["NO_MEJA"] ||
        row["No Meja"] ||
        row["Nomor Meja"] ||
        row["NO"] ||
        0
    );
}

/* =============================
   UPDATE DASHBOARD
============================= */
function updateDashboard() {

    const win = INV.filter(x => (x.OS || "").toLowerCase() === "windows 10 pro 64 bit");
    const chrome = INV.filter(x => (x.OS || "").toLowerCase() === "chromebook");

    const normal   = INV.filter(x => (x.Kondisi || "").toLowerCase() === "normal");
    const ringan   = INV.filter(x => (x.Kondisi || "").toLowerCase().includes("ringan"));
    const berat    = INV.filter(x => (x.Kondisi || "").toLowerCase().includes("berat"));

    const needMouse    = INV.filter(x => (x.Mouse || "").toLowerCase() === "tidak");
    const needKeyboard = INV.filter(x => (x.Keyboard || "").toLowerCase() === "tidak");

    document.getElementById("totalPerangkat").innerText = win.length + chrome.length;
    document.getElementById("totalWindows").innerText = win.length;
    document.getElementById("totalChromebook").innerText = chrome.length;

    document.getElementById("normalCount").innerText = normal.length;
    document.getElementById("ringanCount").innerText = ringan.length;
    document.getElementById("beratCount").innerText = berat.length;

    document.getElementById("mouseNeed").innerText = needMouse.length;
    document.getElementById("keyboardNeed").innerText = needKeyboard.length;
}

/* =============================
   RENDER MAP (FIXED)
============================= */
function renderMap() {
    const grid = document.getElementById("mapGrid");
    grid.innerHTML = "";

    const rows = [
        [22,21,20,19,18,17,"",4,3,2,1],
        [28,27,26,25,24,23,"",8,7,6,5],
        [34,33,32,31,30,29,"",12,11,10,9],
        [40,39,38,37,36,35,"",16,15,14,13]
    ];

    rows.forEach(r => {
        r.forEach(mejaNum => {

            const div = document.createElement("div");

            if (mejaNum === "") {
                div.className = "meja kosong";
                grid.appendChild(div);
                return;
            }

            const item = INV.find(x => getNoMeja(x) === Number(mejaNum));

            let kondisiClass = "kosong";

            if (item) {
                let k = (item.Kondisi || "").toLowerCase();
                if (k === "normal") kondisiClass = "normal";
                else if (k.includes("ringan")) kondisiClass = "ringan";
                else if (k.includes("berat")) kondisiClass = "berat";
            }

            div.className = `meja ${kondisiClass}`;
            div.textContent = mejaNum;

            if (item) div.onclick = () => showDetail(mejaNum);

            grid.appendChild(div);
        });
    });
}

/* =============================
   DETAIL POPUP
============================= */
function showDetail(no) {
    const box = document.getElementById("detailBox");
    const item = INV.find(x => getNoMeja(x) === Number(no));

    box.style.display = "block";

    if (!item) {
        box.innerHTML = `<h3>Meja ${no}</h3>Data tidak ditemukan`;
        return;
    }

    box.innerHTML = `
        <h3>Detail Meja ${no}</h3>
        <b>Merek / Tipe:</b> ${item["Merek / Tipe"] || "-"}<br>
        <b>OS:</b> ${item.OS || "-"}<br>
        <b>Kondisi:</b> ${item.Kondisi || "-"}<br>
        <b>Mouse:</b> ${item.Mouse || "-"}<br>
        <b>Keyboard:</b> ${item.Keyboard || "-"}<br>
    `;
}
</script>

</body>
</html>
