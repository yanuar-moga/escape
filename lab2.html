<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Dashboard & Pemetaan Lab Komputer</title>
    <style>
        body {
            font-family: Calibri, Arial;
            padding: 20px;
            background: #f7f7f7;
        }

        h2 {
            background: #007bff;
            color: white;
            padding: 10px;
            width: fit-content;
        }

        #summary {
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
            width: 420px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        #mapGrid {
            display: grid;
            grid-template-columns: repeat(11, 50px);
            gap: 4px;
            margin-top: 20px;
        }

        .meja {
            width: 50px;
            height: 40px;
            border: 1px solid #555;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
        }

        .kosong { background: transparent; border: none; }
        .normal { background: #5cb85c; color: white; }
        .ringan { background: #f0ad4e; color: black; }
        .berat  { background: #d9534f; color: white; }

        #detailBox {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #aaa;
            width: 350px;
            display: none;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>

<h2>ðŸ“Œ Dashboard Inventaris Lab Komputer</h2>

<div id="summary">Memuat data...</div>

<h3>ðŸ“Œ Pemetaan Meja Lab</h3>
<div id="mapGrid"></div>

<div id="detailBox"></div>

<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script>
let INV = [];
let MAPraw = [];

/* ==========================================================
   LOAD EXCEL
   ========================================================== */
async function loadExcel() {
    const file = "assets/inventarislab2.xlsx";
    const resp = await fetch(file);
    const buf = await resp.arrayBuffer();
    const wb = XLSX.read(buf, { type: "array" });

    INV = XLSX.utils.sheet_to_json(wb.Sheets["INV"]);
    MAPraw = XLSX.utils.sheet_to_json(wb.Sheets["MAP"], { header: 1 });

    processSummary();
    renderMAP();
}
loadExcel();

/* ==========================================================
   HITUNG STATISTIK
   ========================================================== */
function processSummary() {

    const totalDevices = INV.length;

    const totalLaptop = INV.filter(
        x => (x.OS || "").toLowerCase() === "windows 10 pro 64 bit"
    ).length;

    const totalChromebook = INV.filter(
        x => (x.OS || "").toLowerCase() === "chromebook"
    ).length;

    const normal = INV.filter(
        x => (x.Kondisi || "").toLowerCase() === "normal"
    ).length;

    const ringan = INV.filter(
        x => (x.Kondisi || "").toLowerCase().includes("ringan")
    ).length;

    const berat = INV.filter(
        x => (x.Kondisi || "").toLowerCase().includes("berat")
    ).length;

    const needMouse = INV.filter(
        x => (x.Mouse || "").toLowerCase() === "tidak"
    ).length;

    const needKeyboard = INV.filter(
        x => (x.Keyboard || "").toLowerCase() === "tidak"
    ).length;

    document.getElementById("summary").innerHTML = `
        <b>Total Perangkat:</b> ${totalDevices}<br>
        <b>Total Laptop:</b> ${totalLaptop}<br>
        <b>Total Chromebook:</b> ${totalChromebook}<br><br>

        <b>Normal:</b> ${normal} |
        <b>Rusak Ringan:</b> ${ringan} |
        <b>Rusak Berat:</b> ${berat}<br><br>

        <b>Kebutuhan Mouse:</b> ${needMouse}<br>
        <b>Kebutuhan Keyboard:</b> ${needKeyboard}<br>
    `;
}

/* ==========================================================
   RENDER MAP SESUAI FORMAT Bâ€“G  /  Iâ€“K
   ========================================================== */
function renderMAP() {
    const grid = document.getElementById("mapGrid");
    grid.innerHTML = "";

    MAPraw.forEach(row => {
        const left = row.slice(1, 7);   // Kolom Bâ€“G
        const right = row.slice(8, 11); // Kolom Iâ€“K

        const combined = [...left, "", ...right];

        combined.forEach(meja => {
            const div = document.createElement("div");

            if (!meja || meja === "") {
                div.className = "meja kosong";
                grid.appendChild(div);
                return;
            }

            const no = Number(meja);
            const item = INV.find(x => Number(x["NO MEJA"]) === no);

            let kondisi = "kosong";
            if (item) {
                const k = (item.Kondisi || "").toLowerCase();
                if (k === "normal") kondisi = "normal";
                else if (k.includes("ringan")) kondisi = "ringan";
                else if (k.includes("berat")) kondisi = "berat";
            }

            div.className = "meja " + kondisi;
            div.textContent = no;

            div.onclick = () => showDetail(no);

            grid.appendChild(div);
        });
    });
}

/* ==========================================================
   DETAIL MEJA
   ========================================================== */
function showDetail(no) {
    const box = document.getElementById("detailBox");
    const item = INV.find(x => Number(x["NO MEJA"]) === Number(no));

    if (!item) {
        box.style.display = "block";
        box.innerHTML = `<b>Data tidak ditemukan untuk meja ${no}</b>`;
        return;
    }

    box.style.display = "block";
    box.innerHTML = `
        <div class="title">Meja Nomor ${no}</div>
        <b>Merek / Tipe:</b> ${item["Merek / Tipe"] || "-"}<br>
        <b>OS:</b> ${item.OS || "-"}<br>
        <b>Kondisi:</b> ${item.Kondisi || "-"}<br>
        <b>Mouse:</b> ${item.Mouse || "-"}<br>
        <b>Keyboard:</b> ${item.Keyboard || "-"}<br>
    `;
}
</script>

</body>
</html>
