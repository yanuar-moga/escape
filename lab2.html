<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <title>Dashboard Inventaris Lab Komputer 2</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.72/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.72/vfs_fonts.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

    <style>
        body {
            font-family: 'Calibri', sans-serif;
            background: #f4f7fb;
            padding: 20px;
            margin: 0;
        }
        .header {
            background: #0056b3;
            padding: 15px 25px;
            color: white;
            font-size: 28px;
            font-weight: bold;
            border-left: 10px solid #ffcc00;
            width: fit-content;
            border-radius: 5px;
        }
        .card-container {
            display: grid;
            grid-template-columns: repeat(3, 260px);
            gap: 15px;
            margin-top: 20px;
        }
        .card { background: white; border-left: 6px solid #ffcc00; padding: 15px; border-radius: 8px; box-shadow: 0 3px 6px rgba(0,0,0,0.15); font-size: 18px; }
        .card-title { color: #0056b3; font-weight: bold; }
        #mapGrid { display: grid; grid-template-columns: repeat(11, 55px); gap: 6px; margin-top: 30px; margin-bottom: 40px; }

        .meja { width: 55px; height: 45px; border-radius: 6px; font-weight: bold; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: 0.3s; }
        .normal { background: #28a745; color: white; }
        .ringan { background: #ffc107; color: black; animation: glowYellow 1.4s infinite; }
        .berat { background: #dc3545; color: white; animation: glowRed 1.4s infinite; }
        .kosong { background: transparent; border: none; cursor: default; }

        @keyframes glowYellow { 0%{box-shadow:0 0 4px #ffc107;} 50%{box-shadow:0 0 12px #ffdd55;} 100%{box-shadow:0 0 4px #ffc107;} }
        @keyframes glowRed { 0%{box-shadow:0 0 4px #dc3545;} 50%{box-shadow:0 0 14px #ff5555;} 100%{box-shadow:0 0 4px #dc3545;} }

        #detailBox { background: white; width: 380px; padding: 18px; border-radius: 8px; box-shadow: 0 3px 8px rgba(0,0,0,0.2); display: none; margin-bottom:40px; }
        #detailBox h3 { margin-top: 0; color: #0056b3; border-left: 6px solid #ffcc00; padding-left: 8px; }

        /* Charts 3 kolom */
        .chart-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 40px; }
        .chart-card { background:white; padding:15px; border-radius:10px; box-shadow:0 3px 8px rgba(0,0,0,0.15); }

        #exportBtn { margin-top:25px; background:#0056b3; color:white; padding:10px 18px; border-radius:6px; cursor:pointer; border:none; font-size:16px; }
    </style>
</head>
<body>
<div class="header">üìò Dashboard Inventaris Lab Komputer</div>

<div id="dashboard" class="card-container">
    <div class="card"><div class="card-title">Total Perangkat</div><span id="totalPerangkat">-</span></div>
    <div class="card"><div class="card-title">Jumlah Windows</div><span id="totalWindows">-</span></div>
    <div class="card"><div class="card-title">Jumlah Chromebook</div><span id="totalChromebook">-</span></div>

    <div class="card"><div class="card-title">Perangkat Normal</div><span id="normalCount">-</span></div>
    <div class="card"><div class="card-title">Rusak Ringan</div><span id="ringanCount">-</span></div>
    <div class="card"><div class="card-title">Rusak Berat</div><span id="beratCount">-</span></div>

    <div class="card"><div class="card-title">Kebutuhan Mouse</div><span id="mouseNeed">-</span></div>
    <div class="card"><div class="card-title">Kebutuhan Keyboard</div><span id="keyboardNeed">-</span></div>
</div>

<h2 style="color:#0056b3;margin-top:35px;">üìç Peta Meja Lab dan Lokasi Laptop</h2>
<div id="mapGrid"></div>
<div id="detailBox"></div>

<!-- 3 Chart Kolom -->
<div class="chart-row">
    <div class="chart-card"><canvas id="chartPie"></canvas></div>
    <div class="chart-card"><canvas id="chartBar"></canvas></div>
    <div class="chart-card"><canvas id="chartOS"></canvas></div>
</div>

<button id="exportBtn">üìÑ Export PDF</button>

<script>
let INV = [];
async function loadExcel() {
    const res = await fetch("assets/inventarislab2.xlsx");
    const buf = await res.arrayBuffer();
    const wb = XLSX.read(buf, { type: "array" });
    INV = XLSX.utils.sheet_to_json(wb.Sheets["INV"]);
    updateDashboard(); renderMap(); renderCharts(){
    const normal = INV.filter(x=>(x.Kondisi||"").toLowerCase()==="normal").length;
    const ringan = INV.filter(x=>(x.Kondisi||"").toLowerCase().includes("ringan")).length;
    const berat  = INV.filter(x=>(x.Kondisi||"").toLowerCase().includes("berat")).length;
    const total = normal + ringan + berat;

    const normalPct = (normal/total*100).toFixed(1);
    const ringanPct = (ringan/total*100).toFixed(1);
    const beratPct = (berat/total*100).toFixed(1);

    const win = INV.filter(x=>(x.OS||"").toLowerCase()==="windows 10 pro 64 bit").length;
    const chrome = INV.filter(x=>(x.OS||"").toLowerCase()==="chromebook").length;

    pieChart = new Chart(chartPie, { type:'pie', data:{ labels:[`Normal (${normal} / ${normalPct}%)`,`Ringan (${ringan} / ${ringanPct}%)`,`Berat (${berat} / ${beratPct}%)`], datasets:[{ data:[normal,ringan,berat] }] } });

    barChart = new Chart(chartBar, { type:'bar', data:{ labels:[`Normal (${normalPct}%)`,`Ringan (${ringanPct}%)`,`Berat (${beratPct}%)`], datasets:[{ data:[normal,ringan,berat] }] } });

    osChart = new Chart(chartOS, { type:'doughnut', data:{ labels:['Windows','Chromebook'], datasets:[{ data:[win,chrome] }] } });}();
}
loadExcel();

function updateDashboard() {
    const win = INV.filter(x => (x.OS||"").toLowerCase()==="windows 10 pro 64 bit");
    const chrome = INV.filter(x => (x.OS||"").toLowerCase()==="chromebook");
    const normal = INV.filter(x => (x.Kondisi||"").toLowerCase()==="normal");
    const ringan = INV.filter(x => (x.Kondisi||"").toLowerCase().includes("ringan"));
    const berat  = INV.filter(x => (x.Kondisi||"").toLowerCase().includes("berat"));
    const needMouse = INV.filter(x => (x.Mouse||"").toLowerCase()==="tidak");
    const needKeyboard = INV.filter(x => (x.Keyboard||"").toLowerCase()==="tidak");

    totalPerangkat.innerText = win.length + chrome.length;
    totalWindows.innerText = win.length;
    totalChromebook.innerText = chrome.length;
    normalCount.innerText = normal.length;
    ringanCount.innerText = ringan.length;
    beratCount.innerText = berat.length;
    mouseNeed.innerText = needMouse.length;
    keyboardNeed.innerText = needKeyboard.length;
}

function renderMap() {
    const grid = document.getElementById("mapGrid"); grid.innerHTML="";
    const rows = [
        [22,21,20,19,18,17,"",4,3,2,1],
        [28,27,26,25,24,23,"",8,7,6,5],
        [34,33,32,31,30,29,"",12,11,10,9],
        [40,39,38,37,36,35,"",16,15,14,13]
    ];

    rows.forEach(r=>r.forEach(no=>{
        const d=document.createElement("div");
        if(no===""){ d.className="meja kosong"; grid.appendChild(d); return; }
        const item = INV.find(x => Number(String(x["NO MEJA"]).trim()) === Number(no));
        let cls="kosong";
        if(item){ let k=(item.Kondisi||"").toLowerCase(); if(k==="normal")cls="normal"; else if(k.includes("ringan"))cls="ringan"; else if(k.includes("berat"))cls="berat"; }
        d.className=`meja ${cls}`;
        d.textContent=no;
        if(item) d.onclick=()=>showDetail(no);
        grid.appendChild(d);
    }));
}

function showDetail(no){
    const box=document.getElementById("detailBox");
    const item = INV.find(x => Number(String(x["NO MEJA"]).trim()) === Number(no));
    box.style.display="block";
    if(!item){ box.innerHTML=`<h3>Meja ${no}</h3>Data tidak ditemukan`; return; }

    const ket = item["Keterangan"] ? ` (${item["Keterangan"]})` : "";

    box.innerHTML=`
      <h3>Detail Meja ${no}</h3>
      <b>Merek / Tipe:</b> ${item["Merek / Tipe"]||"-"}<br>
      <b>No Inventaris:</b> ${item["No Inventaris"]||"-"}<br>
      <b>Processor:</b> ${item["Processor"]||"-"}<br>
      <b>RAM:</b> ${item["RAM"]||"-"}<br>
      <b>Storage:</b> ${item["Storage"]||"-"}<br>
      <b>Layar:</b> ${item["Layar"]||"-"}<br>
      <b>OS:</b> ${item.OS||"-"}<br>
      <b>Kondisi:</b> ${item.Kondisi||"-"} ${ket}<br>
      <b>Mouse:</b> ${item.Mouse||"-"}<br>
      <b>Keyboard:</b> ${item.Keyboard||"-"}<br>`;
}

/* ================== CHART ================== */
let pieChart, barChart, osChart;
function renderCharts(){
    const normal = INV.filter(x=>(x.Kondisi||"").toLowerCase()==="normal").length;
    const ringan = INV.filter(x=>(x.Kondisi||"").toLowerCase().includes("ringan")).length;
    const berat  = INV.filter(x=>(x.Kondisi||"").toLowerCase().includes("berat")).length;
    const win = INV.filter(x=>(x.OS||"").toLowerCase()==="windows 10 pro 64 bit").length;
    const chrome = INV.filter(x=>(x.OS||"").toLowerCase()==="chromebook").length;

    pieChart = new Chart(chartPie, { type:'pie', data:{ labels:['Normal','Ringan','Berat'], datasets:[{ data:[normal,ringan,berat] }] } });

    barChart = new Chart(chartBar, { type:'bar', data:{ labels:['Normal','Ringan','Berat'], datasets:[{ data:[normal,ringan,berat] }] } });

    osChart = new Chart(chartOS, { type:'doughnut', data:{ labels:['Windows','Chromebook'], datasets:[{ data:[win,chrome] }] } });
}

/* ============ EXPORT PDF ============ */

document.getElementById("exportBtn").onclick=()=>{
    const normal = INV.filter(x=>(x.Kondisi||"").toLowerCase()==="normal").length;
    const ringan = INV.filter(x=>(x.Kondisi||"").toLowerCase().includes("ringan")).length;
    const berat  = INV.filter(x=>(x.Kondisi||"").toLowerCase().includes("berat")).length;

    const doc = {
        content:[
            { text:'Laporan Inventaris Lab Komputer', style:'header' },
            { text:`Normal: ${normal}`, margin:[0,10,0,0] },
            { text:`Rusak Ringan: ${ringan}` },
            { text:`Rusak Berat: ${berat}` },
            { text:'‚Äî Generated Automatically ‚Äî', style:'footer', margin:[0,30,0,0] }
        ],
        styles:{ header:{fontSize:20,bold:true}, footer:{italics:true} }
    };
    pdfMake.createPdf(doc).download('laporan.pdf');
}
</script>

</body>
</html>

